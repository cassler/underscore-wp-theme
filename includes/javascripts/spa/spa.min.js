/*! 1.1.5 */
!function(window,$,_,Backbone){function CollectionsApp(){var _Collections={},_Models={},_Routers={},_Views={},_mappings={standard:"articles",aside:"articles",chat:"articles",status:"articles",audio:"audios",gallery:"photos",image:"photos",link:"links",quote:"quotes",video:"videos"},_history={},_renderEnqueues=function(a,b,c){var d=_.difference(_.keys(b),c),e=_.filter(b,function(a){return _.contains(d,a.handle)});"scripts"===a?_renderScripts(e):_renderStyles(e)},_renderScripts=function(a){_.each(a,function(a){collectionsSPAData.scripts.push(a.handle);var b=a.footer?"body":"head";if(_.contains(["mediaelement","wp-mediaelement"],a.handle)&&(b="body"),a.extra_data){var c=document.createElement("script"),d=document.createTextNode("//<![CDATA[ \n"+a.extra_data+"\n//]]>");c.type="text/javascript",c.appendChild(d),document.getElementsByTagName(b)[0].appendChild(c)}_loadAndExecute(a.src,b,a.handle,function(){$(window.document).trigger("post-load")})})},_renderStyles=function(styles){_.each(styles,function(list,iterator){collectionsSPAData.styles.push(list.handle);var style=document.createElement("link");style.rel="stylesheet",style.href=list.src,style.id=list.handle+"-css",!list.conditional||isIE&&eval(list.conditional.replace(/%ver/g,IEVersion))||(style=!1),style&&document.getElementsByTagName("head")[0].appendChild(style)})},_loadAndExecute=function(a,b,c,d){var e,f=document.createElement("script");f.setAttribute("src",a),d&&(f.onreadystatechange=f.onload=function(){e||d(),e=!0}),document.getElementsByTagName(b)[0].appendChild(f)},_postLoadJS=function(){$(window.document).trigger("post-load"),"undefined"!=typeof mejs&&$(".wp-audio-shortcode, .wp-video-shortcode").mediaelementplayer()},_templateOptions={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g},_spinner=$(".cspa-spinner"),_spinnerTimeout=0,_initSpinner=function(){_spinnerTimeout=window.setTimeout(function(){_spinner.show()},1e3)},_clearSpinner=function(){window.clearTimeout(_spinnerTimeout),_spinner.hide()};return{Collections:_Collections,Models:_Models,Routers:_Routers,Views:_Views,mappings:_mappings,history:_history,renderEnqueues:_renderEnqueues,renderScripts:_renderScripts,renderStyles:_renderStyles,loadAndExecute:_loadAndExecute,postLoadJS:_postLoadJS,templateOptions:_templateOptions,spinner:_spinner,spinnerTimeout:_spinnerTimeout,initSpinner:_initSpinner,clearSpinner:_clearSpinner}}window.CollectionsApp=new CollectionsApp}(window,jQuery,_,Backbone),function(a,b,c,d,e){e.Collections.PostArchive=b.Collection.extend({initialize:function(b){this.set("model",b),this.listenTo(this,"reset",this.addAll);var d=this;c(a.document).on("faded-in",function(){d.updateLoadMoreButton()})},$archiveWrapper:c("#archive-wrapper"),$loadMoreWrapper:c(".stream-footer"),$body:c("body"),url:function(){return-1===e.history.current.pathname.indexOf("?")?"?cspa-json=1":e.history.current.pathname+"&cspa-json=1"},parse:function(a){return e.queriedObject=a.global.queriedObject,e.enqueues=a.global.enqueues,e.nextButton=a.global.nextButton,e.bodyClasses=a.global.bodyClasses,e.isHome=a.global.isHome,e.isArchive=a.global.isArchive,e.isTax=a.global.isTax,e.titleAttr=a.global.titleAttr,e.archiveTitle=a.global.archiveTitle,a.posts},addOne:function(a){var b=new e.Views.PostArchive({model:a,collection:this});return b.render(),b.html},addAll:function(){var a,b=this,c="",f="",g="";this.$body.attr("class",e.bodyClasses),this.$archiveWrapper.empty(),-1!==e.bodyClasses.indexOf("term-post-format-image")?(c='<div id="photo-content-wrapper">',g='<div class="column-sizer"></div><div class="gutter-sizer"></div></div>'):-1!==e.bodyClasses.indexOf("term-post-format-video")&&(c='<div id="audio-content-wrapper">',g="</div>"),1===e.isArchive&&1!==e.isTax&&(c+='<h3 class="stream-title">'+e.archiveTitle+"</h3>"),d.each(b.models,function(a){f+=b.addOne(a)}),a=c+f+g,e.renderEnqueues("scripts",e.enqueues.scripts,collectionsSPAData.scripts),e.renderEnqueues("styles",e.enqueues.styles,collectionsSPAData.styles),e.clearSpinner(),this.$archiveWrapper.append(a).finish().show(),e.postLoadJS()},updateLoadMoreButton:function(){"undefined"==typeof e.nextButton?this.$loadMoreWrapper.hide().fadeIn("fast"):this.$loadMoreWrapper.html(e.nextButton).hide().fadeIn("fast")}})}(window,Backbone,jQuery,_,CollectionsApp),function(a,b,c,d,e){e.Models.Core=b.Model.extend({initialize:function(){this.createNewPostArchiveInstance()},defaults:{postArchiveInstance:null},createNewPostArchiveInstance:function(){var a=new e.Collections.PostArchive({model:new e.Models.Post});this.set("postArchiveInstance",a)}})}(window,Backbone,jQuery,_,CollectionsApp),function(a,b,c,d,e){e.Models.Post=b.Model.extend({parse:function(a){var b=a.posts[0];return b.enqueues=a.global.enqueues,b.queriedObject=a.global.queriedObject,b.titleAttr=a.global.titleAttr,b},url:function(){return"?p="+parseInt(this.id)+"&cspa-json=1"}})}(window,Backbone,jQuery,_,CollectionsApp),function(a,b,c,d,e){var f=a.document;e.Views.Core=b.View.extend({el:function(){return f.getElementById("container")},$archiveWrapper:c("#archive-wrapper"),$loadMoreWrapper:c(".stream-footer"),events:{"click .cspa-control":"initRouter"},initRouter:function(c){c.preventDefault();var f="";c.target.pathname?f=c.target.pathname:c.target.getAttribute("data-pathname")&&(f=c.target.getAttribute("data-pathname"));var g=c.target.search;g="undefined"===g?"":g;var h=a.location.search;h="undefined"===h?"":h,f+g!==a.location.pathname+h&&(this.$archiveWrapper.fadeOut("slow"),this.$loadMoreWrapper.fadeOut("slow"),d.each(a.collectionsTimeouts,function(b){a.clearTimeout(b)}),a.collectionsTimeouts=[],e.initSpinner(),"undefined"!=typeof c.target.search&&""!==c.target.search&&(f+=c.target.search),"/"===f.charAt(0)&&(f=f.substr(1)),(null===f||""===f)&&(f="/"),0==collectionsSPAData.permalink&&"/"===f&&(f="?view=stream"),e.history[f]={pathname:f},b.history.navigate(f,{trigger:!0}))},fetchData:function(){var a=this.model.get("postArchiveInstance"),b={};b.reset=!0,a.fetch(b)}})}(window,Backbone,jQuery,_,CollectionsApp,collectionsTimeouts),function(a,b,c,d,e){e.Views.PostArchive=b.View.extend({el:"div",className:"post",html:"",renderTemplate:function(a){if(d.isNull(e.queriedObject)||1===e.isHome||1===e.isArchive&&0===e.isTax)var b="stream";else var b=d.contains(["","chat","status"],a.postFormat)?"standard":a.postFormat;var f=c("#tmpl-collections-archive-"+b).html();return d.template(f,a,e.templateOptions)},render:function(){e.eventAggregator.trigger("domchange:title",e.titleAttr);var a=this.model.toJSON();return this.html=this.renderTemplate(a),this}})}(window,Backbone,jQuery,_,CollectionsApp),function(a,b,c,d,e){e.Views.PostSingle=b.View.extend({el:c("#cspa-post-wrapper"),$body:c("body"),$cspaPost:c("#cspa-post"),$footer:c("#footer"),initialize:function(){this.listenTo(this.model,"change",this.render)},events:{"click .collections-post-nav":"initRouter"},initRouter:function(a){a.preventDefault(),this.$cspaPost.fadeOut("slow"),this.$footer.fadeOut("slow"),e.initSpinner();var d=c(a.target).parent(),f=d.get(0).pathname,g=d.get(0).search;"undefined"!=typeof g&&""!==g&&(f+=g),b.history.navigate(f,{trigger:!0})},fetchData:function(a){d.isNaN(a)||(this.model.set({id:a},{silent:!0}),this.model.fetch())},renderTemplate:function(a){var b=d.contains(["","chat","status"],a.postFormat)?"standard":a.postFormat,f=c("#tmpl-collections-"+b).html();return d.template(f,a,e.templateOptions)},render:function(){var a=this.model.toJSON(),b=this.renderTemplate(a);e.eventAggregator.trigger("domchange:title",a.titleAttr),this.$body.attr("class",d.escape(a.bodyClasses));var f=this;return this.$cspaPost.html(b).hide().fadeIn("fast",function(){c(".collections-post-nav").length>0&&(f.updateNavigation("prev",a),f.updateNavigation("next",a)),e.renderEnqueues("scripts",a.enqueues.scripts,collectionsSPAData.scripts),e.postLoadJS()}),this.$footer.fadeIn("fast"),e.clearSpinner(),e.renderEnqueues("styles",a.enqueues.styles,collectionsSPAData.styles),this},updateNavigation:function(a,b){if(d.contains(["prev","next"],a)){var e=a+"PostID",f=a+"PostURL",g=c(".collections-post-nav[rel="+a+"]");e in b&&f in b&&""!==b[e]&&""!==b[f]?g.attr("data-id",parseInt(b[e])).attr("href",encodeURI(b[f])).fadeIn("slow"):g.fadeOut("slow").attr("data-id","").attr("href","#")}}})}(window,Backbone,jQuery,_,CollectionsApp),function(a,b,c,d,e){e.Routers.Router=b.Router.extend({initialize:function(a){this.view=a.view},$htmlBody:c("body,html"),routes:{"*notFound":"default","":"default"},"default":function(b){this.$htmlBody.animate({scrollTop:0},500),null===b&&(b="/");var d=a.location.search;if("/"!==b&&null!==b||""===d||"undefined"===d||"undefined"!==e.history[d]&&(b=d),e.history.current=e.history[b],"1"===collectionsSPAData.isSingle){var f=c('a.collections-post-nav[href*="'+b+'"]');this.view.fetchData(f.attr("data-id"))}else("1"===collectionsSPAData.isTax||"1"===collectionsSPAData.isFrontPage||"1"===collectionsSPAData.isArchive||"1"===collectionsSPAData.isHome)&&this.view.fetchData()}})}(window,Backbone,jQuery,_,CollectionsApp),function(a,b,c,d,e){var f=!(!e.history||!e.history.pushState);if(f){var g;if("1"===collectionsSPAData.isTax||"1"===collectionsSPAData.isFrontPage||"1"===collectionsSPAData.isArchive||"1"===collectionsSPAData.isHome){g=new a.Views.Core({model:new a.Models.Core});{new a.Views.PostArchive}}if("1"===collectionsSPAData.isSingle&&(g=new a.Views.PostSingle({model:new a.Models.Post})),"object"==typeof g){a.eventAggregator=c.extend({},d.Events),a.eventAggregator.on("domchange:title",function(a){b("title").html(a)}),a.history[collectionsSPAData.pathname]={pathname:collectionsSPAData.pathname};{new a.Routers.Router({view:g})}d.history.start({pushState:!0,silent:!0})}}else b(".stream-footer").on("click",".cspa-load-more",function(){e.location=b(this).attr("data-url")})}(CollectionsApp,jQuery,_,Backbone,window);